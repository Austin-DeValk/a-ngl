<html>
  <head>
	  <title>a-ngl</title>
    <!-- Original found at https://a-ngl.glitch.me/ -->
    
    <!-- A frame -->
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
    
    <!-- SUPER HANDS (needs A frame 8.2) -->
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>
    
    <!-- Physics system 
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.1.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>-->
    
    <!-- Event sets -->
    <script src="https://unpkg.com/aframe-event-set-component@^4.1.1/dist/aframe-event-set-component.min.js"></script>
    
	  <!-- NGL -->
    <script src="./a-ngl.js"></script>
    <script src="./ngl-dev.js"></script>
    
    <!-- Sharedspace 
    <script src="https://unpkg.com/aframe-sharedspace-component@1.0.1/dist/aframe-sharedspace-component.min.js"></script>-->
    
    <!-- Motion capture -->
    <script src="https://unpkg.com/aframe-motion-capture-components/dist/aframe-motion-capture-components.min.js"></script>
    
    <!-- A frame GUI component 
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>-->
    
    <script>
    
    // turn controller's physics presence on only while button held down
    AFRAME.registerComponent('phase-shift', {
      init: function () {
        var el = this.el
        el.addEventListener('gripdown', function () {
          el.setAttribute('collision-filter', {collisionForces: true})
        })
        el.addEventListener('gripup', function () {
          el.setAttribute('collision-filter', {collisionForces: false})
        })
      }
    })
      
    window.openDropdown = function() {
      console.log("opendropdown");
      var animateDropdown = document.getElementById("dropani");
      var animateDropdown1 = document.getElementById("dropani1");
      var animateDropdownVal = document.getElementById("dropvalani");
      var animateDropdownVal1 = document.getElementById("dropvalani1");
      var animateDropdownVal2 = document.getElementById("dropvalani2");
      animateDropdownVal.emit('opendropdown');
      animateDropdownVal1.emit('opendropdown');
      animateDropdownVal2.emit('opendropdown');   
      animateDropdown1.emit('opendropdown');
      animateDropdown.emit('opendropdown');
    }; 
    
    window.changeMol = function(targetSel,newMol) {
      targetEl = queryNglMol(targetSel);
      targetEl.setAttribute('ngl-mol',{src: newMol});
    };
      
    </script>
  </head>	
  <body>
	  <a-scene
             light="defaultLightsEnabled: true" background="color: #D3D3D3">
           <!--avatar-recorder mc-patch
           avatar-replayer="">-->
      <a-assets>
        <!-- Super Hands raycaster controller -->
        <a-mixin id="pointer" raycaster="showLine: true; objects: .molwrapper"
                 super-hands="colliderEvent: raycaster-intersection;
                              colliderEventProperty: els;
                              colliderEndEvent:raycaster-intersection-cleared;
                              colliderEndEventProperty: clearedEls;"></a-mixin>
        <a-mixin id="controller-right-rc" mixin="pointer" vive-controls="hand: right"
                 oculus-touch-controls="hand: right" windows-motion-controls="hand: right"
                 gearvr-controls daydream-controls oculus-go-controls></a-mixin>
        <a-mixin id="controller-left-rc" mixin="pointer" vive-controls="hand: left"
                 oculus-touch-controls="hand: left" windows-motion-controls="hand: left"></a-mixin>
        
        <!-- Super Hands physics controllers -->
        <a-mixin id="touch" physics-collider phase-shift
                 collision-filter="collisionForces: false"
                 static-body="shape: sphere; sphereRadius: 0.02"
                 super-hands="colliderEvent: collisions;
                              colliderEventProperty: els;
                              colliderEndEvent: collisions;
                              colliderEndEventProperty: clearedEls;"></a-mixin>
        <a-mixin id="controller-right-touch" mixin="touch" vive-controls="hand: right"
                 oculus-touch-controls="hand: right" windows-motion-controls="hand: right"></a-mixin>
        <a-mixin id="controller-left-touch" mixin="touch" vive-controls="hand: left"
                 oculus-touch-controls="hand: left" windows-motion-controls="hand: left"></a-mixin>
        
        <!-- Basic super hands controllers -->
        <a-mixin id="controller-left-basic" sphere-collider="objects: .molwrapper"
                 super-hands hand-controls="left"></a-mixin>
        <a-mixin id="controller-right-basic" sphere-collider="objects: .molwrapper"
                 super-hands hand-controls="right"></a-mixin>
        
        <!-- molwrapper box -->
        <a-mixin id="molwrapper" hoverable grabbable stretchable
                 draggable droppable clickable></a-mixin>
      </a-assets>

      <!-- PLAYER -->
      <a-entity>
        
        <!-- Cursor type camera from a-ngl-fork3 -->
        <a-camera wasd-controls>
          <a-cursor></a-cursor>
        </a-camera>
        
        <!-- super hands mouse raycaster camera
        <a-entity camera wasd-controls position="0 1 1"
                  capture-mouse
                  raycaster="objects: .molwrapper" cursor="rayOrigin:mouse"
                  static-body="shape: sphere; sphereRadius: 0.001"
                  super-hands="colliderEvent: raycaster-intersection;
                               colliderEventProperty: els;
                               colliderEndEvent:raycaster-intersection-cleared;
                               colliderEndEventProperty: clearedEls;">
        </a-entity>-->
        
        <!-- Super Hands controllers 
        <a-entity>
          <a-entity id="rhand" mixin="controller-right-rc"></a-entity>
          <a-entity id="lhand" mixin="controller-left-rc"></a-entity>
        </a-entity>-->
      </a-entity>
      
      <!-- Ground static body 
      <a-box static-body width="100" height="1" depth="100" visible="true" color="grey" position="0 0 0"></a-box>-->
      
      <!-- Molecules -->
      <a-box 
             class="molwrapper" mixin="molwrapper" rotation="0 0 0" position="0 1.5 -.6"
             depth="0.2" width="0.2" height="0.2" wireframe="true" color="blue">
          <!-- -->
          <a-entity ngl-mol="src: rcsb://1crn;
                             repAlgebra: protein=cartoon=bfactor; 
                             wrapperOpacity: 0.1"
                    position="0 0 0" scale="0.006 0.006 0.006"></a-entity>
      </a-box>

      <!-- GUI MENU 
      <a-entity position="2 1.5 -4" rotation="0 0 0">
        <a-entity id="dropdownContainer" position="0 0 -1">
          <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal"
                                component-padding="0.1" opacity="0" width="2.5" height="0.75"
                                position="0 0.375 0" rotation="0 0 0">
            <a-gui-icon-label-button width="2.8" height="0.75" onclick="openDropdown" icon="android-menu"
              value="Visual Settings" font-family="Arial" visible="true">
              <a-animation attribute="rotation" id="dropani" begin="opendropdown" dur="1000"
                           fill="forwards" to="180 0 0"></a-animation>
              <a-animation attribute="visible" id="dropani1" begin="opendropdown"
                           fill="forwards" delay="500" to="false"></a-animation>						
              <a-animation attribute="rotation" id="dropaniback" begin="closedropdown"
                           dur="1000" fill="forwards" to="0 0 0"></a-animation>
              <a-animation attribute="visible" id="dropani1back" begin="closedropdown"
                           fill="forwards" delay="500" to="true"></a-animation>	
            </a-gui-icon-label-button>				
          </a-gui-flex-container>
          <a-gui-flex-container flex-direction="column" justify-content="center" align-items="normal"
                                component-padding="0.1" opacity="0" width="2.5" height="0.75"
                                position="0 0 -0.15" rotation="0 0 0" scale="1 0.001 0.001" visible="false">
            <a-gui-button width="2.5" height="0.75" value="5GKP" font-family="Arial"
                          onclick="changeMol('rcsb://1crn', 'rcsb://5gkp');" ></a-gui-button>
            <a-gui-button width="2.5" height="0.75" onclick="cartoon" value="Cartoon" font-family="Arial"></a-gui-button>
            <a-gui-button width="2.5" height="0.75" onclick="ball" value="Ball+Stick" font-family="Arial"></a-gui-button>
            <a-gui-icon-button width="0.5" height="0.5" onclick="closeDropdown" icon="android-close"></a-gui-icon-button>
            <a-animation attribute="scale" id="dropvalani" begin="opendropdown"
                         dur="1000" fill="forwards" to="1 1 1"></a-animation>	
            <a-animation attribute="position" id="dropvalani1" begin="opendropdown"
                         dur="1000" fill="forwards" to="0 0.375 0.15"></a-animation>						
            <a-animation attribute="visible" id="dropvalani2" begin="opendropdown"
                         fill="forwards" dur="100" to="true"></a-animation>						
            <a-animation attribute="scale" id="dropvalaniback" begin="closedropdown"
                         dur="1000" fill="forwards" to="1 0.001 0.001"></a-animation>	
            <a-animation attribute="position" id="dropvalani1back" begin="closedropdown"
                         dur="1000" fill="forwards" to="0 0 -0.15"></a-animation>						
            <a-animation attribute="visible" id="dropvalani2back" begin="closedropdown"
                         fill="forwards" delay="500" dur="100" to="false"></a-animation>						
          </a-gui-flex-container>
        </a-entity>
      </a-entity>-->
    </a-scene>
    <!-- link for mc-patch component 
    <a id="downloadAnchorElem"></a>-->
  </body>
</html>